# ğŸ”§ Debug Commands & Tools\n\n## ğŸ¯ Debug Locations\n\n### Logcat Filters\n\n#### 1. Xem táº¥t cáº£ notification logs\n```\nFilter: \"ğŸ“…|ğŸ“|ğŸ””|âš ï¸|âŒ|âœ…\"\n```\n\n#### 2. Chá»‰ xem Exam notifications\n```\nFilter: \"ğŸ“|EXAM\"\n```\n\n#### 3. Chá»‰ xem Schedule notifications\n```\nFilter: \"ğŸ“…|SCHEDULE\"\n```\n\n#### 4. Xem errors\n```\nFilter: \"âŒ|ERROR|Exception\"\n```\n\n---\n\n## ğŸ§ª Test Logs\n\n### Expected logs khi add exam successful\n```\nğŸ“ [ENTER] _scheduleNotificationForExam for [SUBJECT], ID: [ID]\nâœ… exam.id is [ID], continuing...\nâš ï¸ Exam notifications are enabled in settings\nğŸ“ ========================================\nğŸ“ EXAM NOTIFICATION SETUP\nğŸ“ Subject: [SUBJECT]\nğŸ“ Exam date/time: [DATETIME]\nğŸ“ Reminder time setting: [MINUTES] minutes before\nğŸ“ Notification time: [NOTIFICATION_TIME]\nğŸ“ Current time: [CURRENT_TIME]\nğŸ“ Minutes until notification: [MINUTES_DIFF]\n\nğŸ”” ========================================\nğŸ”” SCHEDULING NOTIFICATION\nğŸ”” ID: [ID]\nğŸ”” Title: ğŸ“ Sáº¯p Ä‘áº¿n giá» thi: [SUBJECT]\nğŸ”” Body: PhÃ²ng [ROOM] â€¢ [TIME]\nğŸ”” Scheduled Time (notification): [NOTIFICATION_TIME]\nğŸ”” Current Time: [CURRENT_TIME]\nğŸ”” Time Until Notification: [MINUTES_DIFF] minutes\nâœ… Exam notification scheduled successfully\n```\n\n### Red flags (logs that indicate problems)\n```\nâŒ exam.id is NULL! Cannot schedule notification\nâŒ Exam notifications are disabled in settings\nâŒ Notification NOT scheduled - reminder time already passed\nâš ï¸ Notification time is in the past\n```\n\n---\n\n## ğŸ“Š Debug Info Popup\n\n### CÃ¡ch má»Ÿ\n1. **Settings page** â†’ Má»¥c **\"Chung\"**\n2. **\"ğŸ§ª Test Notification\"** button\n3. Nháº¥n **Debug** (biá»ƒu tÆ°á»£ng ğŸ›)\n\n### ThÃ´ng tin hiá»ƒn thá»‹\n```\nPending Notifications: [COUNT]\n\nID: [ID]\nTitle: [TITLE]\nBody: [BODY]\nPayload: [PAYLOAD]\nScheduled Time: [DATETIME]\n```\n\n### Kiá»ƒm tra\n- [ ] CÃ³ Ä‘Ãºng sá»‘ lÆ°á»£ng notifications\n- [ ] ID khá»›p vá»›i exam/schedule ID\n- [ ] Title cÃ³ emoji Ä‘Ãºng (ğŸ“ for exam, ğŸ“š for schedule)\n- [ ] Scheduled Time = event time - reminder minutes\n- [ ] Payload cÃ³ format Ä‘Ãºng (exam_X hoáº·c schedule_X)\n\n---\n\n## ğŸ§¬ Code Debug Points\n\n### ExamProvider\n\n**File:** `lib/features/exam/presentation/providers/exam_provider.dart`\n\n**Key debug lines:**\n```dart\nLine 107: if (_notificationSettings != null && \n              !_notificationSettings!.enableExamNotifications) {\n    // Check if exam notifications are enabled\n}\n\nLine 115: final reminderMinutes = _notificationSettings?.examReminderMinutes ?? 60;\n    // Get reminder time from settings\n\nLine 140: final notificationTime = examDateTime.subtract(Duration(minutes: reminderMinutes));\n    // Calculate correct notification time\n\nLine 147: if (notificationTime.isAfter(DateTime.now())) {\n    // Check if notification time is in future\n}\n```\n\n**Add print statements to debug:**\n```dart\nprint('ğŸ§ª enableExamNotifications: ${_notificationSettings?.enableExamNotifications}');\nprint('ğŸ§ª examReminderMinutes: ${_notificationSettings?.examReminderMinutes}');\nprint('ğŸ§ª notificationTime: $notificationTime');\nprint('ğŸ§ª isAfter: ${notificationTime.isAfter(DateTime.now())}');\n```\n\n---\n\n### ScheduleProvider\n\n**File:** `lib/features/schedule/presentation/providers/schedule_provider.dart`\n\n**Key debug lines:**\n```dart\nLine 165: final targetWeekday = dayOfWeek == 8 ? 7 : dayOfWeek - 1;\n    // Conversion from app dayOfWeek to Dart weekday\n\nLine 168: int daysToAdd = (targetWeekday - now.weekday) % 7;\n    // Calculate days until next occurrence\n```\n\n**Add print statements to debug:**\n```dart\nprint('ğŸ§ª dayOfWeek: $dayOfWeek');\nprint('ğŸ§ª targetWeekday: $targetWeekday');\nprint('ğŸ§ª now.weekday: ${now.weekday}');\nprint('ğŸ§ª daysToAdd: $daysToAdd');\nprint('ğŸ§ª nextOccurrence: $nextOccurrence');\n```\n\n---\n\n## ğŸ” Manual Testing Steps\n\n### Test Case 1: Basic Exam Notification\n\n```kotlin\n// Step 1: Set reminder to 5 minutes\nNavigate to Settings\nFind \"ThÃ´ng bÃ¡o lá»‹ch thi\"\nSelect \"5 phÃºt trÆ°á»›c\"\nVerify: subtitle shows \"5 phÃºt trÆ°á»›c\"\n\n// Step 2: Add an exam\nNavigate to Exam\nTap Add (+)\nFill:\n  - Subject: ToÃ¡n\n  - Room: A101  \n  - Date: Tomorrow or later (future)\n  - Start time: 14:00\n  - End time: 15:00\nTap Save\nVerify: Exam appears in list\n\n// Step 3: Check notification\nNavigate to Settings\nTap \"ğŸ§ª Test Notification\"\nTap Debug button\n\n// Step 4: Verify\nCheck if notification exists with:\n  - Title: \"ğŸ“ Sáº¯p Ä‘áº¿n giá» thi: ToÃ¡n\"\n  - Scheduled Time: 13:55 (14:00 - 5 min)\n  - Status: âœ… PASS if found, âŒ FAIL if not\n```\n\n### Test Case 2: Schedule Notification\n\n```kotlin\n// Step 1: Set reminder to 10 minutes\nNavigate to Settings\nFind \"ThÃ´ng bÃ¡o lá»‹ch há»c\"\nSelect \"10 phÃºt trÆ°á»›c\"\n\n// Step 2: Add schedule\nNavigate to Schedule\nTap Add\nFill:\n  - Subject: Tiáº¿ng Anh\n  - Day: Thá»© 4 (Thursday)\n  - Start time: 09:00\n  - End time: 10:30\n  - Room: B102\nTap Save\n\n// Step 3: Check\nDebug popup\nLook for schedule with:\n  - Title: \"ğŸ“š Sáº¯p Ä‘áº¿n giá» há»c: Tiáº¿ng Anh\"\n  - Next occurrence day: Thursday (should be next week if today != Thursday)\n  - Scheduled Time: 08:50 (09:00 - 10 min)\n  - Status: âœ… PASS\n```\n\n---\n\n## ğŸ¯ Common Issues & Solutions\n\n### Issue: Notification not found in debug popup\n**Possible causes:**\n1. Settings are disabled\n2. Notification time is in the past\n3. ID is null\n\n**Debug steps:**\n```\n1. Check logs for \"âŒ\" or \"disabled\"\n2. Verify current time < notification time\n3. Check if ID is not null\n```\n\n### Issue: Scheduled time is wrong\n**Possible causes:**\n1. reminderMinutes not read from settings\n2. Calculation error\n\n**Debug steps:**\n```\n1. Check if examReminderMinutes = correct value\n2. Verify: scheduledTime = eventTime - reminderMinutes\n3. Check timezone (should be Asia/Ho_Chi_Minh)\n```\n\n### Issue: Day calculation is wrong (Schedule)\n**Possible causes:**\n1. dayOfWeek conversion error\n2. Weekday calculation error\n\n**Debug steps:**\n```\n1. Print dayOfWeek (should be 2-8)\n2. Print targetWeekday (should be 1-7)\n3. Verify: targetWeekday = dayOfWeek == 8 ? 7 : dayOfWeek - 1\n4. Check: daysToAdd = (targetWeekday - now.weekday) % 7\n```\n\n---\n\n## ğŸ“± Android Debug Settings\n\n### Enable Debug Logging\n\n1. **Open Logcat in Android Studio**\n   - View â†’ Tool Windows â†’ Logcat\n   - Or: Alt+6 on Windows\n\n2. **Set filter**\n   - Search box: `\"ğŸ“…|ğŸ“|ğŸ””\"`\n   - Level: Verbose\n\n3. **Clear logs**\n   - Button: Clear (trash icon)\n   - Before each test\n\n4. **Export logs**\n   - File â†’ Save selected logs\n   - Use for debugging later\n\n---\n\n## ğŸ¯ Verification Checklist\n\n### Before marking as âœ… PASS:\n\n```\nâ–¡ Exam notification:\n  â–¡ Title contains \"ğŸ“ Sáº¯p Ä‘áº¿n giá» thi\"\n  â–¡ Scheduled time = exam time - 5 minutes\n  â–¡ ID matches exam ID\n  â–¡ Status \"successfully\"\n\nâ–¡ Schedule notification:\n  â–¡ Title contains \"ğŸ“š Sáº¯p Ä‘áº¿n giá» há»c\"\n  â–¡ Scheduled time = class time - 10 minutes\n  â–¡ Next occurrence is correct day\n  â–¡ Status \"successfully\"\n\nâ–¡ Settings integration:\n  â–¡ Disabling notifications stops scheduling\n  â–¡ Changing reminder time reschedules\n  â–¡ All changes save correctly\n\nâ–¡ No errors:\n  â–¡ No exceptions in logcat\n  â–¡ No null pointer errors\n  â–¡ No \"âŒ\" logs\n```\n\n---\n\n## ğŸ’¡ Pro Tips\n\n1. **Clear data before testing**\n   - Android Studio â†’ Device Monitor\n   - App Storage â†’ Clear\n   - Restart app\n\n2. **Use fake future date**\n   - Set exam for 1 week later\n   - Easier to verify in debug popup\n\n3. **Check multiple scenarios**\n   - Same day (if time hasn't passed)\n   - Next week\n   - Far future\n   - Past (should not schedule)\n\n4. **Monitor notifications**\n   - After schedule, check notification shade\n   - (Some Android versions show scheduled notifications)\n\n5. **Use debugger**\n   - Set breakpoints in _scheduleNotificationForExam\n   - Step through code\n   - Verify variables\n\n---\n\n## ğŸ¬ Recording Test Video\n\n1. **Setup**\n   - Clear logcat\n   - Slow animation (Settings â†’ Developer â†’ Animation Scale = 0.5x)\n   - Enable debug messages\n\n2. **Recording**\n   - Record screen (Power + Volume up)\n   - Navigate slowly\n   - Let logs fully display\n\n3. **Highlight**\n   - Zoom in on important parts\n   - Show scheduled time clearly\n   - Show debug popup\n\n4. **Narration**\n   - Explain steps\n   - Point out verification points\n   - Show \"âœ… PASS\" at end\n\n---\n\n**Last updated:** 2025-12-13\n